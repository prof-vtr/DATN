<!doctype html>
<html class="no-js" lang="zxx">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>Trang chủ | Cửa hàng ZMobile</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Favicons -->
    <link rel="shortcut icon" href="~/assets/images/favicon.ico">
    <link rel="apple-touch-icon" href="~/assets/images/icon.png">

    <!-- Google font (font-family: 'Roboto', sans-serif; Poppins ; Satisfy) -->
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700,800" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Poppins:300,300i,400,400i,500,600,600i,700,700i,800" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Roboto:100,300,400,500,700,900" rel="stylesheet">

    <!-- Stylesheets -->
    <link rel="stylesheet" href="~/assets/css/user/bootstrap.min.css">
    <link rel="stylesheet" href="~/assets/css/user/plugins.css">
    <link rel="stylesheet" href="~/assets/css/user/style.css">

    <!-- Cusom css -->
    <link rel="stylesheet" href="~/assets/css/user/custom.css">

    <!-- Modernizer js -->
    <script src="~/assets/js/user/vendor/modernizr-3.5.0.min.js"></script>

</head>

<body>
    <!--[if lte IE 9]>
        <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
    <![endif]-->
    <!-- Main wrapper -->
    <div class="wrapper" id="wrapper">
        <!-- Header -->
        @Html.Partial("Header")
        <!-- //Header -->

        @RenderBody()

        <!-- Footer Area -->
        <footer id="wn__footer" class="footer__area bg__cat--8 brown--color">
            <div class="footer-static-top">
                <div class="container">
                    <div class="row">
                        <div class="col-lg-12">
                            <div class="footer__widget footer__menu">
                                <div class="ft__logo">
                                    <a href="index.html">
                                        <img src="/assets/images/logo/3.png" alt="logo">
                                    </a>
                                    <p>Cửa hàng điện thoại Thế Anh chuyên cung cấp điện thoại chính hãng, phụ kiện công nghệ chất lượng cao, dịch vụ sửa chữa và bảo hành tận tâm.</p>
                                </div>
                                <div class="footer__content">
                                    <ul class="social__net social__net--2 d-flex justify-content-center">
                                        <li><a href="#"><i class="bi bi-facebook"></i></a></li>
                                        <li><a href="#"><i class="bi bi-google"></i></a></li>
                                        <li><a href="#"><i class="bi bi-twitter"></i></a></li>
                                        <li><a href="#"><i class="bi bi-linkedin"></i></a></li>
                                        <li><a href="#"><i class="bi bi-youtube"></i></a></li>
                                    </ul>
                                    <ul class="mainmenu d-flex justify-content-center">
                                        <li><a href="index.html">Trending</a></li>
                                        <li><a href="index.html">Best Seller</a></li>
                                        <li><a href="index.html">All Product</a></li>
                                        <li><a href="index.html">Wishlist</a></li>
                                        <li><a href="index.html">Blog</a></li>
                                        <li><a href="index.html">Contact</a></li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="copyright__wrapper">
                <div class="container">
                    <div class="row">
                        <div class="col-lg-6 col-md-6 col-sm-12">
                            <div class="copyright">
                                <div class="copy__right__inner text-left">
                                    <p>Copyright <i class="fa fa-copyright"></i> <a href="https://freethemescloud.com/">Free themes Cloud.</a> All Rights Reserved</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-6 col-md-6 col-sm-12">
                            <div class="payment text-right">
                                <img src="/assets/images/icons/payment.png" alt="" />
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </footer>
        <!-- //Footer Area -->
        <!-- QUICKVIEW PRODUCT -->
        <div id="quickview-wrapper">
            <!-- Modal -->
            <div class="modal fade" id="product-modal" tabindex="-1" role="dialog" aria-hidden="true">
                <div class="modal-dialog modal__container" role="document">
                    <div class="modal-content">
                        <div class="modal-header modal__header">
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                        </div>
                        <div class="modal-body">
                            <div class="modal-product">
                                <!-- Start product images -->
                                <div class="product-images">
                                    <div class="main-image images">
                                        <img alt="big images" id="modal-product-img">
                                    </div>
                                </div>
                                <!-- end product images -->
                                <div class="product-info">
                                    <h1 id="modal-product-title"></h1>
                                    <div class="rating__and__review">
                                        <ul class="rating">
                                            <li><span class="ti-star"></span></li>
                                            <li><span class="ti-star"></span></li>
                                            <li><span class="ti-star"></span></li>
                                            <li><span class="ti-star"></span></li>
                                            <li><span class="ti-star"></span></li>
                                        </ul>
                                        @*<div class="review">
                                            <a href="#">4 customer reviews</a>
                                        </div>*@
                                    </div>
                                    <div class="price-box-3">
                                        <div class="s-price-box">
                                            <span class="new-price" id="modal-product-sale-price"></span>
                                            <span class="old-price" id="modal-product-original-price"></span>
                                        </div>
                                    </div>
                                    <div class="quick-desc" id="modal-product-description">

                                    </div>
                                    <div class="social-sharing">
                                        <div class="widget widget_socialsharing_widget">
                                            <h3 class="widget-title-modal">Share this product</h3>
                                            <ul class="social__net social__net--2 d-flex justify-content-start">
                                                <li class="facebook"><a href="#" class="rss social-icon"><i class="zmdi zmdi-rss"></i></a></li>
                                                <li class="linkedin"><a href="#" class="linkedin social-icon"><i class="zmdi zmdi-linkedin"></i></a></li>
                                                <li class="pinterest"><a href="#" class="pinterest social-icon"><i class="zmdi zmdi-pinterest"></i></a></li>
                                                <li class="tumblr"><a href="#" class="tumblr social-icon"><i class="zmdi zmdi-tumblr"></i></a></li>
                                            </ul>
                                        </div>
                                    </div>
                                    <div class="addtocart-btn">
                                        <a id="add-btn" style="color: white !important;">Add to cart</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- END QUICKVIEW PRODUCT -->
    </div>
    <!-- //Main wrapper -->
    <!-- JS Files -->
    <script src="~/assets/js/user/vendor/jquery-3.2.1.min.js"></script>
    <script src="~/assets/js/user/popper.min.js"></script>
    <script src="~/assets/js/user/bootstrap.min.js"></script>
    <script src="~/assets/js/user/plugins.js"></script>
    <script src="~/assets/js/user/active.js"></script>

    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.1/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

    <script>

        function openModal(event, id) {

            event.preventDefault();

            $.ajax({
                url: `api/product/get/${id}`,
                method: 'GET',
                contentType: "application/json",
                success: function (res) {
                    $('#modal-product-img').attr('src', '/assets/images/product/' + res.Images);
                    $('#modal-product-title').text(res.ProductName);
                    $('#modal-product-sale-price').text(res.Price - res.Price * (res.SaleOff / 100));
                    $('#modal-product-original-price').text(res.Price);
                    $('#modal-product-description').text(res.Description);
                    $('#product-modal').modal('show');
                    $('#add-btn').attr('onclick', 'addToCart(' + id + ')');
                },
                error: function (err) {
                    alert("Something went wrong: " + err);
                }
            });
            // $('#addtocart-btn').attr('onclick', 'addToCart(' + id + ')');
        }

        function addToCart(event, productId, productName, quantity) {
            $.ajax({
                url: '@Url.Action("AddItemToCart", "Cartbuy")',
                type: 'POST',
                data: { id: productId },
                success: function (result) {
                    if (result.message === "user havent logged in") {
                        alert('Hãy thực hiện đăng nhập trước');
                        window.location.href = "/Page/Login"; // Sửa lại vị trí href
                    } else {
                        // Cập nhật số lượng giỏ hàng
                        alert('Thêm sản phẩm ' + productName + ' số lượng ' + quantity + ' vào giỏ hàng thành công');
                        $('#cart-count').text(result.cartItemCount);
                    }
                },
                error: function () {
                    alert("Có lỗi xảy ra khi thêm sản phẩm vào giỏ hàng.");
                }
            });
        }

        function removeItemFromCart(productId) {
            $.ajax({
                url: '@Url.Action("RemoveItemFromCart", "Cartbuy")',
                type: 'POST',
                data: { id: productId },
                success: function (response) {
                    if (response.success) {
                        // Xóa hàng khỏi giỏ hàng
                        $('tr').has('a[onclick="removeItemFromCart(' + productId + ')"]').remove();

                        // Cập nhật tổng tiền của giỏ hàng
                        $('.cart__total__amount span:last-child').text(response.newTotal.toLocaleString('vi-VN', { style: 'currency', currency: 'VND' }));

                        alert("Sản phẩm đã được xóa khỏi giỏ hàng.");
                    } else {
                        alert(response.message);
                    }
                },
                error: function (xhr, status, error) {
                    alert("Có lỗi xảy ra: " + error);
                }
            });
        }

        function cancelOrder(orderId) {
        if (confirm("Bạn có chắc muốn hủy đơn hàng này không?")) {
            $.ajax({
                url: '@Url.Action("Cancel_Order", "Page")', // Controller và action
                type: 'POST',
                data: { id: orderId }, // Dữ liệu gửi đi
                success: function (response) {
                    alert(response.message); // Hiển thị alert thông báo từ server

                    // Chuyển hướng về lại trang OrderDetail với orderId hiện tại
                    window.location.href = '@Url.Action("OrderDetail", "Page")?orderId=' + orderId;
                },
                error: function () {
                    alert("Có lỗi xảy ra, vui lòng thử lại!");
                }
            });
        }
    }

        $(document).ready(function () {
            // Bắt sự kiện khi người dùng thay đổi số lượng
            $('.product-quantity input').on('change', function () {
                var productId = $(this).attr('data-id'); // Lấy ID sản phẩm từ data-id
                var newQuantity = $(this).val(); // Lấy số lượng mới
                console.log(newQuantity);
                // Gửi yêu cầu AJAX để cập nhật giỏ hàng
                if (newQuantity == 0) {
                    alert('Không được để số lượng về 0');
                    $(this).val(1);
                }

                $.ajax({
                    url: '@Url.Action("UpdateCartup", "Cartbuy")',
                    type: 'POST',
                    data: {
                        id: productId,
                        quantity: newQuantity
                    },
                    success: function (response) {
                        if (response.success !== false) {
                            // Cập nhật SubTotal cho sản phẩm
                            $('td.product-subtotal[data-id="' + productId + '"]').text(response.newSubTotal);

                            // Cập nhật Total cho cả giỏ hàng
                            $('.cart__total__amount span:last-child').text(response.newTotal);
                        } else {
                            alert(response.message);
                        }
                    },
                    error: function (xhr, status, error) {
                        console.log("Có lỗi xảy ra: " + error);
                    }
                });
            });
        });

        $(document).ready(function () {
        $('#cart').click(function () {
            window.location.href = '@Url.Action("Detail_Order", "Page")';
        });
    });

    </script>

</body>

</html>